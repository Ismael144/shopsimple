syntax = "proto3";

package shopsimple.product.v1;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "shopsimple/common/v1/money.proto";
import "shopsimple/common/v1/pagination.proto";

option go_package = "gen/go/shopsimple/product/v1;productv1";
option java_multiple_files = true;
option java_package = "com.shopsimple.product.v1";

// Products service
service ProductService {
  // List paginated products
  rpc List(ListRequest) returns (ListResponse) {
    option (google.api.http) = {
      get: "/products/v1/list"
    };
  };

  // Create New product
  rpc Create(CreateRequest) returns (CreateResponse) {
    option (google.api.http) = {
      post: "/products/v1/create"
      body: "*"
    };
  };

  // Filter by properties
  rpc Filter(FilterRequest) returns (ListResponse) {
    option (google.api.http) = {
      get: "/products/v1/filter"
    };
  };

  // Batch Find by id
  rpc BatchFindById(BatchFindByIdRequest) returns (BatchFindByIdResponse) {
    option (google.api.http) = {
      post: "/products/v1/batch-find-by-id"
      body: "*"
    };
  };

  // Batch Find by id
  rpc FindById(FindByIdRequest) returns (Product) {
    option (google.api.http) = {
      get: "/products/v1"
    };
  };

  // List available product categories 
  rpc ListCategories(google.protobuf.Empty) returns (ListCategoriesResponse) {
    option (google.api.http) = {
      get: "/products/v1/categories"
    };
  };
}

// Represents a product
message Product {
  string          id          = 1;
  string          name        = 2;
  string          description = 3;
  common.v1.Money unit_price  = 4;
  string          image_url   = 6;
  uint64          stock       = 7;
  uint32          rating      = 5;

  // A list of categories that product belongs to
  repeated string           categories = 8;
  google.protobuf.Timestamp created_at = 9;
}

message ListRequest {
  uint32 page      = 1;
  uint32 page_size = 2;
}

message ListResponse {
  repeated Product     products   = 1;
  common.v1.Pagination pagination = 2;
}

message CreateRequest {
  string          name        = 1;
  string          description = 2;
  common.v1.Money unit_price  = 3;
  string          image_url   = 4;
  uint32          stock       = 5;
  int32           rating      = 6;
  repeated string categories  = 7;
}

message CreateResponse {
  string product_id = 1;
}

message FilterRequest {
  uint32          page          = 1;
  uint32          page_size     = 2;
  string          search_string = 3;
  repeated string categories    = 4;
  PriceRanges     price_ranges  = 5;
}

message PriceRanges {
  common.v1.Money min = 1;
  common.v1.Money max = 2;
}

message BatchFindByIdRequest {
  repeated string ids = 1;
}

message BatchFindByIdResponse {
  repeated Product products = 1;
  int64            total    = 2;
}

message FindByIdRequest {
  string id = 1;
}

message ListCategoriesResponse {
  repeated string categories = 1;
}